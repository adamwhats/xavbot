<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="xavbot">

  <xacro:macro name="xavbot_arm" params="prefix='' mesh_dir='package://xavbot_description/meshes' standalone='true'">

  <!-- Constants for robot dimensions -->
  <xacro:property name="PI" value="3.1415926535897931"/>

      <!-- link0 -->
      <xacro:if value="${standalone}">
        <link name="${prefix}base_link" />
        <joint name="${prefix}link0_joint" type="fixed">
          <parent link="${prefix}base_link"/>
          <child link="${prefix}link0"/>
          <origin xyz="0 0 0" rpy="${PI/2} 0 ${PI}"/>
        </joint>
      </xacro:if>

      <xacro:unless value="${standalone}">
        <joint name="${prefix}link0_joint" type="fixed">
          <parent link="${prefix}base_link"/>
          <child link="${prefix}link0"/>
          <origin xyz="0.210 0.200 0.073" rpy="${PI/2} 0 ${PI}"/>
        </joint>
      </xacro:unless>

      <link name="${prefix}link0">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/link0.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/link0.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>
    
        <inertial>
          <origin xyz="0 -0.013 0" rpy="0 0 0"/>
          <mass value="0.0572"/>
          <inertia
            ixx="${0.0572 / 12.0 * (0.0465*0.0465 + 0.034*0.034)}" ixy="0.0" ixz="0.0"
            iyy="${0.0572 / 12.0 * (0.034*0.034 + 0.0285*0.0285)}" iyz="0.0"
            izz="${0.0572 / 12.0 * (0.0285*0.0285 + 0.0465*0.0465)}"/>
        </inertial>
      </link>

      <!-- link1 -->
      <joint name="${prefix}link1_joint" type="revolute">
        <parent link="${prefix}link0"/>
        <child link="${prefix}link1"/>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <dynamics damping="0.2"/>
        <limit
          lower="${-PI/2}"
          upper="${PI/2}"
          effort="4.0"
          velocity="5.5">
        </limit>
      </joint>

      <link name="${prefix}link1">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/link1.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/link1.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>

        <inertial>
          <origin xyz="0 -0.013 0" rpy="0 0 0"/>
          <mass value="0.0572"/>
          <inertia
            ixx="${0.0572 / 12.0 * (0.0465*0.0465 + 0.034*0.034)}" ixy="0.0" ixz="0.0"
            iyy="${0.0572 / 12.0 * (0.034*0.034 + 0.0285*0.0285)}" iyz="0.0"
            izz="${0.0572 / 12.0 * (0.0285*0.0285 + 0.0465*0.0465)}"/>
        </inertial>
      </link>

      <!-- link2 -->
      <joint name="${prefix}link2_joint" type="revolute">
        <parent link="${prefix}link1"/>
        <child link="${prefix}link2"/>
        <origin xyz="0 0.1 0" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <dynamics damping="0.2"/>
        <limit
          lower="${-8 * PI/9}"
          upper="${PI/2}"
          effort="4.0"
          velocity="5.5">
        </limit>
      </joint>

      <link name="${prefix}link2">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/link2.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/link2.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>
      </link>

      <!-- link3 -->
      <joint name="${prefix}link3_joint" type="revolute">
        <parent link="${prefix}link2"/>
        <child link="${prefix}link3"/>
        <origin xyz="-0.1 0.04 0" rpy="0 0 0"/>
        <axis xyz="0 0 1 "/>
        <dynamics damping="0.2"/>
        <limit
          lower="${-PI/2}"
          upper="${PI/2}"
          effort="4.0"
          velocity="5.5">
        </limit>
      </joint>

      <link name="${prefix}link3">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/link3.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/link3.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>
      </link>

      <!-- link4 -->
      <joint name="${prefix}link4_joint" type="revolute">
        <parent link="${prefix}link3"/>
        <child link="${prefix}link4"/>
        <origin xyz="-0.061 0 0" rpy="0 ${-PI/2} 0"/>
        <axis xyz="0 0 1"/>
        <dynamics damping="0.2"/>
        <limit
          lower="-${PI}"
          upper="${PI}"
          effort="4.0"
          velocity="5.5">
        </limit>
      </joint>

      <link name="${prefix}link4">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/link4.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/link4.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>
      </link>

      <!-- hand_tcp -->
      <joint name="${prefix}tcp_joint" type="fixed">
        <parent link="${prefix}link4"/>
        <child link="${prefix}tcp"/>
        <origin xyz="0 0 0.08" rpy="${PI/2} ${-PI/2} 0"/>
      </joint>

      <link name="${prefix}tcp"/>

      <!-- gripper_crank -->
      <joint name="${prefix}gripper_joint" type="revolute">
        <parent link="${prefix}link4"/>
        <child link="${prefix}gripper_crank"/>
        <origin xyz="0 0 0.04" rpy="0 0 0"/>
        <axis xyz="0 0 1"/>
        <limit
          lower="0"
          upper="1.047"
          effort="4.0"
          velocity="5.5">
        </limit>
      </joint>
        
      <link name="${prefix}gripper_crank"/>

      <!-- rightfinger -->
      <joint name="${prefix}rightfinger_joint" type="prismatic">
        <parent link="${prefix}link4"/>
        <child link="${prefix}rightfinger"/>
        <origin xyz="0 0 0.045" rpy="0 0 0"/>
        <axis xyz="-1 0 0"/>
        <limit
          lower="0"
          upper="0.0265"
          effort="9.9"
          velocity="9.9">
        </limit>
        <mimic joint="${prefix}gripper_joint" multiplier="0.024446"/>
      </joint>

      <link name="${prefix}rightfinger">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/finger.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/finger.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>
      </link>

      <!-- leftfinger -->
      <joint name="${prefix}leftfinger_joint" type="prismatic">
        <parent link="${prefix}link4"/>
        <child link="${prefix}leftfinger"/>
        <origin xyz="0 0 0.045" rpy="0 0 ${PI}"/>
        <axis xyz="-1 0 0"/>
        <limit
          lower="0"
          upper="0.0265"
          effort="9.9"
          velocity="9.9">
        </limit>
        <mimic joint="${prefix}gripper_joint" multiplier="0.024446"/>
      </joint>

      <link name="${prefix}leftfinger">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/collision/finger.stl" scale="0.001 0.001 0.001"/>
          </geometry>
        </collision>

        <visual>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
            <mesh filename="${mesh_dir}/visual/finger.stl" scale="0.001 0.001 0.001"/>
          </geometry>
          <material name="grey"/>
        </visual>
      </link>


  </xacro:macro>

</robot>